============================= test session starts =============================
platform win32 -- Python 3.12.0, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\MUHAMMAD HANZLA\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\MUHAMMAD HANZLA\Desktop\Rag\Business-intelligence
plugins: anyio-4.9.0, langsmith-0.7.6, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 21 items

tests/test_llm.py::test_response_not_empty PASSED                        [  4%]
tests/test_llm.py::test_validate_query_empty PASSED                      [  9%]
tests/test_llm.py::test_validate_query_too_long PASSED                   [ 14%]
tests/test_llm.py::test_validate_query_valid PASSED                      [ 19%]
tests/test_llm.py::test_build_llm_without_key PASSED                     [ 23%]
tests/test_rag.py::test_embed_single_text PASSED                         [ 28%]
tests/test_rag.py::test_embed_batch_texts PASSED                         [ 33%]
tests/test_rag.py::test_embed_empty_string PASSED                        [ 38%]
tests/test_rag.py::test_embed_empty_list PASSED                          [ 42%]
tests/test_rag.py::test_embed_invalid_type PASSED                        [ 47%]
tests/test_rag.py::test_lru_cache_working PASSED                         [ 52%]
tests/test_rag.py::test_load_and_chunk_files_valid_txt PASSED            [ 57%]
tests/test_rag.py::test_load_and_chunk_files_empty_list PASSED           [ 61%]
tests/test_rag.py::test_load_and_chunk_files_invalid_path PASSED         [ 66%]
tests/test_rag.py::test_load_and_chunk_files_unsupported_ext PASSED      [ 71%]
tests/test_rag.py::test_upsert_pinecone_missing_key_skipped SKIPPED      [ 76%]
tests/test_rag.py::test_validate_rag_query_valid PASSED                  [ 80%]
tests/test_rag.py::test_validate_rag_query_too_short PASSED              [ 85%]
tests/test_rag.py::test_validate_rag_query_invalid_type PASSED           [ 90%]
tests/test_rag.py::test_retrieval_diversity PASSED                       [ 95%]
tests/test_rag.py::test_async_chain_invocation FAILED                    [100%]

================================== FAILURES ===================================
_________________________ test_async_chain_invocation _________________________

    @pytest.mark.asyncio
    async def test_async_chain_invocation():
        """Stress test the chain with ainvoke."""
        from main import build_llm
        from rag import build_rag_chain
        from unittest.mock import MagicMock
    
        mock_retriever = MagicMock()
        # Simple mock return for aget_relevant_documents
>       mock_retriever.aget_relevant_documents.return_value = [Document(page_content="test")]
                                                               ^^^^^^^^
E       NameError: name 'Document' is not defined

tests\test_rag.py:176: NameError
============================== warnings summary ===============================
<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.

<frozen importlib._bootstrap>:488
  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\langchain_google_genai\chat_models.py:47
  C:\Users\MUHAMMAD HANZLA\AppData\Local\Programs\Python\Python312\Lib\site-packages\langchain_google_genai\chat_models.py:47: FutureWarning: 
  
  All support for the `google.generativeai` package has ended. It will no longer be receiving 
  updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
  See README for more details:
  
  https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md
  
    from google.generativeai.caching import CachedContent  # type: ignore[import]

tests/test_rag.py::test_load_and_chunk_files_valid_txt
  C:\Users\MUHAMMAD HANZLA\Desktop\Rag\Business-intelligence\rag.py:244: DeprecationWarning: There is no current event loop
    loop = asyncio.get_event_loop()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_rag.py::test_async_chain_invocation - NameError: name 'Docu...
============ 1 failed, 19 passed, 1 skipped, 4 warnings in 31.71s =============
